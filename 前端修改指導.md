# 前端修改指導

## 🎯 修改概述

後端API端點已經統一，前端需要相應修改API調用。

## 🔧 需要修改的API端點

### **1. VIP相關API**
```javascript
// ❌ 修改前（舊的）
const vipData = await fetch(`/api/vipstaking/${tokenId}`)
const vipData = await fetch(`https://api.dungeondelvers.xyz/api/vipstaking/${tokenId}`)

// ✅ 修改後（新的）
const vipData = await fetch(`/api/vip/${tokenId}`)
const vipData = await fetch(`https://api.dungeondelvers.xyz/api/vip/${tokenId}`)
```

### **2. Profile相關API**
```javascript
// ❌ 修改前（舊的）
const profileData = await fetch(`/api/playerprofile/${tokenId}`)
const profileData = await fetch(`https://api.dungeondelvers.xyz/api/playerprofile/${tokenId}`)

// ✅ 修改後（新的）
const profileData = await fetch(`/api/profile/${tokenId}`)
const profileData = await fetch(`https://api.dungeondelvers.xyz/api/profile/${tokenId}`)
```

## 📝 具體修改指導

### **1. 搜索和替換**

在前端專案中執行以下搜索替換：

```bash
# 搜索所有 /api/vipstaking/ 並替換為 /api/vip/
find ./src -name "*.js" -o -name "*.ts" -o -name "*.jsx" -o -name "*.tsx" | xargs grep -l "vipstaking"

# 搜索所有 /api/playerprofile/ 並替換為 /api/profile/
find ./src -name "*.js" -o -name "*.ts" -o -name "*.jsx" -o -name "*.tsx" | xargs grep -l "playerprofile"
```

### **2. 常見的檔案位置**

通常需要修改的檔案類型：

#### **API層 (services/api)**
```javascript
// services/api/nft.js 或 services/api/metadata.js
class NFTService {
  async getVipMetadata(tokenId) {
    // ❌ 修改前
    return await fetch(`/api/vipstaking/${tokenId}`);
    
    // ✅ 修改後
    return await fetch(`/api/vip/${tokenId}`);
  }
  
  async getProfileMetadata(tokenId) {
    // ❌ 修改前
    return await fetch(`/api/playerprofile/${tokenId}`);
    
    // ✅ 修改後
    return await fetch(`/api/profile/${tokenId}`);
  }
}
```

#### **React組件**
```javascript
// components/VIPCard.jsx
const VIPCard = ({ tokenId }) => {
  useEffect(() => {
    // ❌ 修改前
    fetch(`/api/vipstaking/${tokenId}`)
    
    // ✅ 修改後
    fetch(`/api/vip/${tokenId}`)
      .then(res => res.json())
      .then(setVipData);
  }, [tokenId]);
};
```

#### **API常數檔**
```javascript
// constants/api.js
export const API_ENDPOINTS = {
  // ❌ 修改前
  VIP: '/api/vipstaking',
  PROFILE: '/api/playerprofile',
  
  // ✅ 修改後
  VIP: '/api/vip',
  PROFILE: '/api/profile',
  
  // 保持不變
  HERO: '/api/hero',
  RELIC: '/api/relic',
  PARTY: '/api/party'
};
```

### **3. 環境變數配置**

檢查是否有環境變數需要更新：

```javascript
// .env
VITE_API_BASE_URL=https://api.dungeondelvers.xyz
REACT_APP_API_BASE_URL=https://api.dungeondelvers.xyz

// 確保這些環境變數指向正確的API域名
```

### **4. 配置檔案**

檢查可能的配置檔案：

#### **config.js**
```javascript
// config/api.js
export const API_CONFIG = {
  baseURL: process.env.VITE_API_BASE_URL || 'https://api.dungeondelvers.xyz',
  endpoints: {
    // ❌ 修改前
    vip: '/api/vipstaking',
    profile: '/api/playerprofile',
    
    // ✅ 修改後
    vip: '/api/vip',
    profile: '/api/profile',
    
    // 保持不變
    hero: '/api/hero',
    relic: '/api/relic',
    party: '/api/party'
  }
};
```

#### **axios/fetch 配置**
```javascript
// utils/api.js
const api = axios.create({
  baseURL: 'https://api.dungeondelvers.xyz'
});

// 確保所有API調用都使用正確的端點
export const fetchVipMetadata = (tokenId) => api.get(`/api/vip/${tokenId}`);
export const fetchProfileMetadata = (tokenId) => api.get(`/api/profile/${tokenId}`);
```

## 🧪 測試指導

### **1. 測試新的API端點**

在瀏覽器開發者工具中測試：

```javascript
// 在瀏覽器 Console 中測試
fetch('/api/vip/1')
  .then(r => r.json())
  .then(console.log);

fetch('/api/profile/1')
  .then(r => r.json())
  .then(console.log);
```

### **2. 檢查Network面板**

確保：
- 沒有 404 錯誤
- API調用使用新的端點
- 回應格式正確

### **3. 測試清單**

- [ ] VIP卡片正常顯示
- [ ] Profile頁面正常載入
- [ ] 沒有API 404錯誤
- [ ] 元數據正確載入
- [ ] 圖片正常顯示

## 📋 確認清單

### **修改完成後檢查：**

1. **搜索確認**
   - [ ] 確認沒有遺留的 `vipstaking` 引用
   - [ ] 確認沒有遺留的 `playerprofile` 引用

2. **功能測試**
   - [ ] VIP功能正常
   - [ ] Profile功能正常
   - [ ] 無控制台錯誤

3. **相容性確認**
   - [ ] 開發環境正常 (localhost:5173)
   - [ ] 生產環境正常 (dungeondelvers.xyz)

## 💡 常見問題

### **Q: 是否需要修改子圖查詢？**
A: 不需要，GraphQL查詢與API路由無關。

### **Q: 是否需要修改智能合約？**
A: 不需要，智能合約沒有變化。

### **Q: 前端快取是否需要清除？**
A: 建議清除快取，避免使用舊的API端點。

### **Q: 如何快速找到所有需要修改的檔案？**
A: 使用以下命令：
```bash
# 搜索所有包含舊API端點的檔案
grep -r "vipstaking\|playerprofile" ./src --include="*.js" --include="*.ts" --include="*.jsx" --include="*.tsx"
```

## 🎉 完成確認

修改完成後，前端應該能正常調用統一後的API端點，並且所有NFT元數據功能都能正常工作。